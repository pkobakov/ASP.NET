/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@aspnet/signalr@1.0.27/dist/esm/WebSocketTransport.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
var __awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){e.done?n(e.value):new o((function(t){t(e.value)})).then(i,s)}c((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var o,r,n,a,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{o=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};import{LogLevel}from"./ILogger";import{TransferFormat}from"./ITransport";import{Arg,getDataDetail}from"./Utils";var WebSocketTransport=function(){function e(e,t,o){this.logger=t,this.accessTokenFactory=e||function(){return null},this.logMessageContent=o}return e.prototype.connect=function(e,t){return __awaiter(this,void 0,void 0,(function(){var o,r=this;return __generator(this,(function(n){switch(n.label){case 0:if(Arg.isRequired(e,"url"),Arg.isRequired(t,"transferFormat"),Arg.isIn(t,TransferFormat,"transferFormat"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(LogLevel.Trace,"(WebSockets transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(o=n.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(o)),[2,new Promise((function(o,n){e=e.replace(/^http/,"ws");var a=new WebSocket(e);t===TransferFormat.Binary&&(a.binaryType="arraybuffer"),a.onopen=function(t){r.logger.log(LogLevel.Information,"WebSocket connected to "+e),r.webSocket=a,o()},a.onerror=function(e){n(e.error)},a.onmessage=function(e){r.logger.log(LogLevel.Trace,"(WebSockets transport) data received. "+getDataDetail(e.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(e.data)},a.onclose=function(e){r.logger.log(LogLevel.Trace,"(WebSockets transport) socket closed."),r.onclose&&(!1===e.wasClean||1e3!==e.code?r.onclose(new Error("Websocket closed with status code: "+e.code+" ("+e.reason+")")):r.onclose())}}))]}}))}))},e.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(LogLevel.Trace,"(WebSockets transport) sending data. "+getDataDetail(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},e.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},e}();export{WebSocketTransport};
//# sourceMappingURL=/sm/16c8ee03d40807ff450cccbcf32d255bbe90287d2a7231be151a65086408768c.map