/**
 * Minified by jsDelivr using Terser v5.3.5.
 * Original file: /npm/@aspnet/signalr@1.0.27/dist/cjs/WebSocketTransport.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,s){function a(e){try{c(r.next(e))}catch(e){s(e)}}function i(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){e.done?n(e.value):new o((function(t){t(e.value)})).then(a,i)}c((r=r.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var o,r,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=a.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{o=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var ILogger_1=require("./ILogger"),ITransport_1=require("./ITransport"),Utils_1=require("./Utils"),WebSocketTransport=function(){function e(e,t,o){this.logger=t,this.accessTokenFactory=e||function(){return null},this.logMessageContent=o}return e.prototype.connect=function(e,t){return __awaiter(this,void 0,void 0,(function(){var o,r=this;return __generator(this,(function(n){switch(n.label){case 0:if(Utils_1.Arg.isRequired(e,"url"),Utils_1.Arg.isRequired(t,"transferFormat"),Utils_1.Arg.isIn(t,ITransport_1.TransferFormat,"transferFormat"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(ILogger_1.LogLevel.Trace,"(WebSockets transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(o=n.sent())&&(e+=(e.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(o)),[2,new Promise((function(o,n){e=e.replace(/^http/,"ws");var s=new WebSocket(e);t===ITransport_1.TransferFormat.Binary&&(s.binaryType="arraybuffer"),s.onopen=function(t){r.logger.log(ILogger_1.LogLevel.Information,"WebSocket connected to "+e),r.webSocket=s,o()},s.onerror=function(e){n(e.error)},s.onmessage=function(e){r.logger.log(ILogger_1.LogLevel.Trace,"(WebSockets transport) data received. "+Utils_1.getDataDetail(e.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(e.data)},s.onclose=function(e){r.logger.log(ILogger_1.LogLevel.Trace,"(WebSockets transport) socket closed."),r.onclose&&(!1===e.wasClean||1e3!==e.code?r.onclose(new Error("Websocket closed with status code: "+e.code+" ("+e.reason+")")):r.onclose())}}))]}}))}))},e.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(ILogger_1.LogLevel.Trace,"(WebSockets transport) sending data. "+Utils_1.getDataDetail(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},e.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},e}();exports.WebSocketTransport=WebSocketTransport;
//# sourceMappingURL=/sm/67bf54034e7eaaae478de81f500bf91048cdb504f4424dc41d9f1fb7f6225573.map